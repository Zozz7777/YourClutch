<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details - Clutch</title>
    <meta name="description" content="View detailed information about this job position at Clutch.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Design.json Compliant Styles -->
    <style>
        :root {
            /* Light theme colors from design.json */
            --background: oklch(1 0 0);
            --foreground: oklch(0.1450 0 0);
            --card: oklch(1 0 0);
            --card-foreground: oklch(0.1450 0 0);
            --primary: oklch(0.5770 0.2450 27.3250);
            --primary-foreground: oklch(0.9850 0 0);
            --secondary: oklch(0.5770 0.2450 27.3250);
            --muted: oklch(0.9700 0 0);
            --muted-foreground: oklch(0.5560 0 0);
            --border: oklch(0.9220 0 0);
            --input: oklch(0.9220 0 0);
            --ring: oklch(0.7080 0 0);
            --success: oklch(0.72 0.2 145);
            --warning: oklch(0.85 0.18 75);
            --info: oklch(0.75 0.1 220);
        }

        body {
            font-family: 'Roboto', ui-sans-serif, sans-serif, system-ui;
            background-color: var(--background);
            color: var(--foreground);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .sticky-apply {
            position: sticky;
            top: 2rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <img src="LogoRed.svg" alt="Clutch" class="h-8 w-auto">
                        <span class="ml-2 text-xl font-bold text-gray-900">Clutch</span>
                    </a>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-gray-600 hover:text-gray-900">Home</a>
                    <a href="index.html#services" class="text-gray-600 hover:text-gray-900">Services</a>
                    <a href="index.html#mission" class="text-gray-600 hover:text-gray-900">Mission</a>
                    <a href="careers.html" class="text-blue-600 font-medium">Careers</a>
                    <a href="index.html#download" class="text-gray-600 hover:text-gray-900">Download</a>
                    <a href="index.html#contact" class="text-gray-600 hover:text-gray-900">Contact</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-gray-600 hover:text-gray-900">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading State -->
    <div id="loading" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="loading inline-block w-8 h-8 bg-blue-600 rounded-full"></div>
            <p class="mt-4 text-gray-600">Loading job details...</p>
        </div>
    </div>

    <!-- Job Details Content -->
    <div id="job-content" class="hidden">
        <!-- Job Header -->
        <section class="bg-white py-12 border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center mb-4">
                    <a href="careers.html" class="text-blue-600 hover:text-blue-700 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Careers
                    </a>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h1 id="job-title" class="text-3xl font-bold text-gray-900 mb-2"></h1>
                                <p id="job-department" class="text-xl text-gray-600 mb-4"></p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span id="job-location"></span>
                                    <span id="job-type"></span>
                                    <span id="job-experience"></span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end space-y-2">
                                <span id="job-status" class="px-3 py-1 bg-success/10 text-success text-sm rounded-full"></span>
                                <span id="job-posted" class="text-sm text-gray-500"></span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-2">Salary Range</h3>
                                <p id="job-salary" class="text-lg text-gray-700"></p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-2">Positions Available</h3>
                                <p id="job-positions" class="text-lg text-gray-700"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1">
                        <div class="sticky-apply bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Apply for this position</h3>
                            <button 
                                id="apply-btn"
                                class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                            >
                                Apply Now
                            </button>
                            <p class="text-sm text-gray-500 mt-3 text-center">
                                Application deadline: <span id="application-deadline"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Job Description -->
        <section class="py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-8">
                        <!-- Description -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">Job Description</h2>
                            <div id="job-description" class="prose prose-gray max-w-none">
                                <!-- Job description will be populated here -->
                            </div>
                        </div>

                        <!-- Requirements -->
                        <div id="requirements-section" class="bg-white rounded-lg shadow-sm p-6 hidden">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">Requirements</h2>
                            <ul id="job-requirements" class="space-y-2">
                                <!-- Requirements will be populated here -->
                            </ul>
                        </div>

                        <!-- Responsibilities -->
                        <div id="responsibilities-section" class="bg-white rounded-lg shadow-sm p-6 hidden">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">Responsibilities</h2>
                            <ul id="job-responsibilities" class="space-y-2">
                                <!-- Responsibilities will be populated here -->
                            </ul>
                        </div>

                        <!-- Benefits -->
                        <div id="benefits-section" class="bg-white rounded-lg shadow-sm p-6 hidden">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">Benefits</h2>
                            <ul id="job-benefits" class="space-y-2">
                                <!-- Benefits will be populated here -->
                            </ul>
                        </div>

                        <!-- Skills -->
                        <div id="skills-section" class="bg-white rounded-lg shadow-sm p-6 hidden">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">Required Skills</h2>
                            <div id="job-skills" class="flex flex-wrap gap-2">
                                <!-- Skills will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Company Info -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">About Clutch</h3>
                            <p class="text-gray-600 text-sm mb-4">
                                We're building the future of automotive technology, creating innovative solutions 
                                that transform how people interact with vehicles and transportation.
                            </p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span class="text-gray-600">Cairo, Egypt</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    <span class="text-gray-600">50-100 employees</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
                                    </svg>
                                    <span class="text-gray-600">Technology</span>
                                </div>
                            </div>
                        </div>

                        <!-- Similar Jobs -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Similar Jobs</h3>
                            <div id="similar-jobs" class="space-y-4">
                                <!-- Similar jobs will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Not Found State -->
    <div id="not-found" class="hidden min-h-screen flex items-center justify-center">
        <div class="text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.709M15 6.291A7.962 7.962 0 0012 5c-2.34 0-4.29 1.009-5.824 2.709" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Job not found</h3>
            <p class="mt-1 text-sm text-gray-500">The job you're looking for doesn't exist or has been removed.</p>
            <div class="mt-6">
                <a href="careers.html" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                    View All Jobs
                </a>
            </div>
        </div>
    </div>

    <!-- Application Modal -->
    <div id="application-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">Apply for Position</h2>
                        <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="job-details-modal" class="mb-6">
                        <!-- Job details will be populated here -->
                    </div>
                    
                    <form id="application-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="first-name" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                                <input type="text" id="first-name" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="last-name" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                                <input type="text" id="last-name" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input type="tel" id="phone" name="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                            <input type="text" id="location" name="location" placeholder="City, Country" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="resume" class="block text-sm font-medium text-gray-700 mb-1">Resume *</label>
                            <input type="file" id="resume" name="resume" accept=".pdf,.doc,.docx" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <p class="text-sm text-gray-500 mt-1">PDF, DOC, or DOCX files only (max 5MB)</p>
                        </div>
                        
                        <div>
                            <label for="cover-letter" class="block text-sm font-medium text-gray-700 mb-1">Cover Letter</label>
                            <textarea id="cover-letter" name="coverLetter" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <!-- Custom Questions -->
                        <div id="custom-questions">
                            <!-- Custom questions will be populated here -->
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="consent" name="consent" required class="mt-1 mr-2">
                            <label for="consent" class="text-sm text-gray-700">
                                I consent to the processing of my personal data for recruitment purposes. *
                            </label>
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="communication" name="communication" required class="mt-1 mr-2">
                            <label for="communication" class="text-sm text-gray-700">
                                I agree to receive communication regarding my application. *
                            </label>
                        </div>
                        
                        <div class="flex justify-end space-x-4">
                            <button type="button" id="cancel-application" class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <img src="LogoRed.svg" alt="Clutch" class="h-8 w-auto">
                        <span class="ml-2 text-xl font-bold">Clutch</span>
                    </div>
                    <p class="text-gray-400">Building the future of automotive technology.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Company</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html#mission" class="text-gray-400 hover:text-white">About</a></li>
                        <li><a href="careers.html" class="text-gray-400 hover:text-white">Careers</a></li>
                        <li><a href="index.html#contact" class="text-gray-400 hover:text-white">Contact</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Services</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html#services" class="text-gray-400 hover:text-white">Auto Parts</a></li>
                        <li><a href="index.html#services" class="text-gray-400 hover:text-white">Fleet Management</a></li>
                        <li><a href="index.html#services" class="text-gray-400 hover:text-white">Analytics</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Connect</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Clutch. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Global variables
        let currentJob = null;
        let similarJobs = [];

        // API Configuration
        const API_BASE_URL = 'https://clutch-main-nk7x.onrender.com/api/v1/careers';

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobSlug = urlParams.get('slug') || window.location.pathname.split('/').pop();
            
            if (jobSlug) {
                loadJobDetails(jobSlug);
            } else {
                showNotFound();
            }
            
            setupEventListeners();
        });

        // Load job details from API
        async function loadJobDetails(slug) {
            try {
                const response = await fetch(`${API_BASE_URL}/jobs/${slug}`);
                const data = await response.json();
                
                if (data.success && data.data.job) {
                    currentJob = data.data.job;
                    displayJobDetails();
                    loadSimilarJobs();
                } else {
                    showNotFound();
                }
            } catch (error) {
                console.error('Error loading job details:', error);
                showNotFound();
            } finally {
                hideLoading();
            }
        }

        // Display job details
        function displayJobDetails() {
            if (!currentJob) return;

            // Basic info
            document.getElementById('job-title').textContent = currentJob.title;
            document.getElementById('job-department').textContent = currentJob.department;
            document.getElementById('job-location').textContent = currentJob.locations && currentJob.locations.length > 0 
                ? currentJob.locations.map(loc => `${loc.city}, ${loc.country}`).join(', ')
                : 'Remote';
            document.getElementById('job-type').textContent = currentJob.employmentType;
            document.getElementById('job-experience').textContent = currentJob.experienceLevel;
            document.getElementById('job-status').textContent = currentJob.status;
            document.getElementById('job-posted').textContent = `Posted ${new Date(currentJob.publishedDate || currentJob.createdAt).toLocaleDateString()}`;
            
            // Salary
            const salary = currentJob.salary && currentJob.salary.min > 0 && currentJob.salary.max > 0 
                ? `${currentJob.salary.min.toLocaleString()} - ${currentJob.salary.max.toLocaleString()} ${currentJob.salary.currency}`
                : 'Salary not specified';
            document.getElementById('job-salary').textContent = salary;
            
            // Positions
            document.getElementById('job-positions').textContent = `${currentJob.positions} position${currentJob.positions > 1 ? 's' : ''}`;
            
            // Application deadline
            const deadline = currentJob.applicationDeadline 
                ? new Date(currentJob.applicationDeadline).toLocaleDateString()
                : 'No deadline';
            document.getElementById('application-deadline').textContent = deadline;
            
            // Description
            document.getElementById('job-description').innerHTML = currentJob.description || '<p>No description available.</p>';
            
            // Requirements
            if (currentJob.requirements && currentJob.requirements.length > 0) {
                document.getElementById('requirements-section').classList.remove('hidden');
                document.getElementById('job-requirements').innerHTML = currentJob.requirements
                    .map(req => `<li class="flex items-start"><span class="text-blue-600 mr-2">•</span><span>${req}</span></li>`)
                    .join('');
            }
            
            // Responsibilities
            if (currentJob.responsibilities && currentJob.responsibilities.length > 0) {
                document.getElementById('responsibilities-section').classList.remove('hidden');
                document.getElementById('job-responsibilities').innerHTML = currentJob.responsibilities
                    .map(resp => `<li class="flex items-start"><span class="text-blue-600 mr-2">•</span><span>${resp}</span></li>`)
                    .join('');
            }
            
            // Benefits
            if (currentJob.benefits && currentJob.benefits.length > 0) {
                document.getElementById('benefits-section').classList.remove('hidden');
                document.getElementById('job-benefits').innerHTML = currentJob.benefits
                    .map(benefit => `<li class="flex items-start"><span class="text-success mr-2">✓</span><span>${benefit}</span></li>`)
                    .join('');
            }
            
            // Skills
            if (currentJob.skills && currentJob.skills.length > 0) {
                document.getElementById('skills-section').classList.remove('hidden');
                document.getElementById('job-skills').innerHTML = currentJob.skills
                    .map(skill => `<span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">${skill}</span>`)
                    .join('');
            }
            
            showJobContent();
        }

        // Load similar jobs
        async function loadSimilarJobs() {
            try {
                const response = await fetch(`${API_BASE_URL}/jobs?department=${currentJob.department}&limit=3`);
                const data = await response.json();
                
                if (data.success && data.data.jobs) {
                    similarJobs = data.data.jobs.filter(job => job._id !== currentJob._id).slice(0, 3);
                    displaySimilarJobs();
                }
            } catch (error) {
                console.error('Error loading similar jobs:', error);
            }
        }

        // Display similar jobs
        function displaySimilarJobs() {
            const container = document.getElementById('similar-jobs');
            
            if (similarJobs.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No similar jobs found.</p>';
                return;
            }
            
            container.innerHTML = similarJobs.map(job => `
                <div class="border-l-4 border-blue-500 pl-4">
                    <h4 class="font-medium text-gray-900 text-sm">${job.title}</h4>
                    <p class="text-gray-600 text-xs">${job.department}</p>
                    <a href="job-details.html?slug=${job.slug}" class="text-blue-600 text-xs hover:text-blue-700">
                        View Details →
                    </a>
                </div>
            `).join('');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Apply button
            document.getElementById('apply-btn').addEventListener('click', openApplicationModal);
            
            // Application modal
            document.getElementById('close-modal').addEventListener('click', closeApplicationModal);
            document.getElementById('cancel-application').addEventListener('click', closeApplicationModal);
            document.getElementById('application-form').addEventListener('submit', handleApplicationSubmit);
        }

        // Open application modal
        function openApplicationModal() {
            if (!currentJob) return;

            document.getElementById('job-details-modal').innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">${currentJob.title}</h3>
                    <p class="text-gray-600 mb-2">${currentJob.department}</p>
                    <p class="text-sm text-gray-700">${currentJob.description ? currentJob.description.substring(0, 200) + '...' : 'No description available'}</p>
                </div>
            `;

            // Populate custom questions
            const customQuestionsContainer = document.getElementById('custom-questions');
            if (currentJob.customQuestions && currentJob.customQuestions.length > 0) {
                customQuestionsContainer.innerHTML = currentJob.customQuestions.map((question, index) => `
                    <div class="mb-4">
                        <label for="custom-${index}" class="block text-sm font-medium text-gray-700 mb-1">
                            ${question.question} ${question.required ? '*' : ''}
                        </label>
                        ${question.type === 'textarea' 
                            ? `<textarea id="custom-${index}" name="customAnswers[${index}].answer" ${question.required ? 'required' : ''} class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>`
                            : `<input type="${question.type === 'text' ? 'text' : 'text'}" id="custom-${index}" name="customAnswers[${index}].answer" ${question.required ? 'required' : ''} class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">`
                        }
                        <input type="hidden" name="customAnswers[${index}].question" value="${question.question}">
                        <input type="hidden" name="customAnswers[${index}].questionType" value="${question.type}">
                    </div>
                `).join('');
            } else {
                customQuestionsContainer.innerHTML = '';
            }

            document.getElementById('application-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close application modal
        function closeApplicationModal() {
            document.getElementById('application-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('application-form').reset();
        }

        // Handle application submission
        async function handleApplicationSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            if (!currentJob) {
                alert('Job information not available');
                return;
            }

            const applicationData = {
                job: currentJob._id,
                candidate: {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    location: {
                        city: formData.get('location')?.split(',')[0]?.trim(),
                        country: formData.get('location')?.split(',')[1]?.trim() || 'Egypt'
                    }
                },
                consent: {
                    dataProcessing: formData.get('consent') === 'on',
                    communication: formData.get('communication') === 'on'
                }
            };

            try {
                const response = await fetch(`${API_BASE_URL}/jobs/${currentJob._id}/apply`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Application submitted successfully!');
                    closeApplicationModal();
                } else {
                    alert('Failed to submit application: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Failed to submit application. Please try again.');
            }
        }

        // Show/hide states
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showJobContent() {
            document.getElementById('job-content').classList.remove('hidden');
        }

        function showNotFound() {
            document.getElementById('not-found').classList.remove('hidden');
        }
    </script>
</body>
</html>
